\chapter{Applications of Jensen's inequality}

In this chapter, $h$ denotes the function $h(x) := x \log \frac{1}{x}$ for $x \in [0,1]$.

\begin{lemma}[Concavity]\label{concave}
  \lean{Real.strictConcaveOn_negMulLog}\leanok
  $h$ is strictly concave on $[0,\infty)$.
\end{lemma}

\begin{proof} \leanok Check that $h'$ is strictly monotone decreasing.
\end{proof}


\begin{lemma}[Jensen]\label{jensen}
  \lean{Real.sum_negMulLog_le} \leanok
  If $S$ is a finite set, and $\sum_{s \in S} w_s = 1$ for some non-negative $w_s$, and $p_s \in [0,1]$ for all $s \in S$, then
  $$ \sum_{s \in S} w_s h(p_s) \leq h(\sum_{s \in S} w_s p_s).$$
\end{lemma}

\begin{proof} \uses{concave}\leanok Apply Jensen and \Cref{concave}.
\end{proof}

\begin{lemma}[Converse Jensen]\label{converse-jensen}
  \lean{Real.sum_negMulLog_eq_iff}\leanok
If equality holds in the above lemma, then $p_s = \sum_{s \in S} w_s h(p_s)$ whenever $w_s \neq 0$.
\end{lemma}

\begin{proof} \uses{concave}\leanok Need some converse form of Jensen, not sure if it is already in Mathlib.  May also wish to state it as an if and only if.
\end{proof}

\begin{lemma}[log sum inequality]
  \label{log-sum}\lean{Real.sum_mul_log_div_leq}\leanok
  If $S$ is a finite set, and $a_s,b_s$ are non-negative for $s\in S$, then
  $$\sum_{s\in S} a_s \log\frac{a_s}{b_s}\ge \left(\sum_{s\in S}a_s\right)\log\frac{\sum_{s\in S} a_s}{\sum_{s\in S} b_s},$$
  with the convention $0\log\frac{0}{b}=0$ for any $b\ge 0$ and $0\log\frac{a}{0}=\infty$ for any $a>0$.
\end{lemma}
\begin{proof}\leanok
  Let $B:=\sum_{s\in S} b_s$. Apply Jensen and \Cref{concave} to show that $\sum_{s\in S} \frac{b_s}{B} h(\frac{a_s}{b_s})\ge h(\frac{\sum_{s\in S} a_s}{B})$.
\end{proof}

\begin{lemma}[converse log sum]
  \label{converse-log-sum}\lean{Real.sum_mul_log_div_eq_iff}\leanok
If equality holds in \Cref{log-sum}, then $a_s=r\cdot b_s$ for every $s\in S$, for some constant $r\in \mathbb{R}$.
\end{lemma}

\begin{proof}\leanok
\uses{concave} By the fact that $h$ is strictly concave and the equality condition of Jensen.
\end{proof}
